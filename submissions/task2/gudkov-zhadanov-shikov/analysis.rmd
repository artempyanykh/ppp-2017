---
title: "ÏÏÏ2"
author: "Ãóäêîâ-Æàäàíîâ-Øèêîâ"
date: '15 àïðåëÿ 2017 ã '
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Îò÷åò ïî ÏÏÏ


```{r intro, include = FALSE}
library(ggplot2)
prodData <- read.csv('production-data.csv')
prodHarpy <- subset(prodData, prodData$supplier == 'harpy.co')
prodWesteros <- subset(prodData, prodData$supplier != 'harpy.co')


harpy.id <- unique(prodHarpy$unsullen.id)
westeros.id <- unique(prodWesteros$unsullen.id)
harpyDefectData <- c()
westerosDefectData <- c()
for (i in 1:length(harpy.id)) {
  harpyData <- subset(prodHarpy, prodHarpy$unsullen.id == harpy.id[i])
  westerosData <- subset(prodWesteros, prodWesteros$unsullen.id == westeros.id[i])
  
  harpy.production <- harpyData$produced[harpyData$produced != 0]
  defects.one.month <- (subset(harpyData, harpyData$production.date == harpyData$report.date - 1))$defects
  defects.two.month <- (subset(harpyData, harpyData$production.date == harpyData$report.date - 2))$defects
  defects.three.month <- (subset(harpyData,harpyData$production.date == harpyData$report.date - 3))$defects
  defects.four.month <- (subset(harpyData, harpyData$production.date == harpyData$report.date - 4))$defects
  defects.five.month <- (subset(harpyData, harpyData$production.date == harpyData$report.date - 5))$defects
  defects.six.month <- (subset(harpyData, harpyData$production.date == harpyData$report.date - 6))$defects
  
  mean.one <- sum(defects.one.month * harpy.production) / sum(harpy.production)
  mean.two <- sum(defects.two.month * harpy.production[1:5]) / sum(harpy.production[1:5])
  mean.three <- sum(defects.three.month * harpy.production[1:4]) / sum(harpy.production[1:4])
  mean.four <- sum(defects.four.month * harpy.production[1:3]) / sum(harpy.production[1:3])
  mean.five <- sum(defects.five.month * harpy.production[1:2]) / sum(harpy.production[1:2])
  mean.six <- sum(defects.six.month * harpy.production[1:1]) / sum(harpy.production[1:1])
  harpy.data.id <- c(harpy.id[i], mean.one, mean.two, mean.three, mean.four, mean.five, mean.six)
  harpyDefectData <- rbind(harpyDefectData, harpy.data.id)
  
  westeros.production <- westerosData$produced[westerosData$produced != 0]
  defects.one.month <- (subset(westerosData, westerosData$production.date == westerosData$report.date - 1))$defects
  defects.two.month <- (subset(westerosData, westerosData$production.date == westerosData$report.date - 2))$defects
  defects.three.month <- (subset(westerosData, westerosData$production.date == westerosData$report.date - 3))$defects
  defects.four.month <- (subset(westerosData, westerosData$production.date == westerosData$report.date - 4))$defects
  defects.five.month <- (subset(westerosData, westerosData$production.date == westerosData$report.date - 5))$defects
  defects.six.month <- (subset(westerosData, westerosData$production.date == westerosData$report.date - 6))$defects
  mean.one <- sum(defects.one.month * westeros.production) / sum(westeros.production)
  mean.two <- sum(defects.two.month * westeros.production[1:5]) / sum(westeros.production[1:5])
  mean.three <- sum(defects.three.month * westeros.production[1:4]) / sum(westeros.production[1:4])
  mean.four <- sum(defects.four.month * westeros.production[1:3]) / sum(westeros.production[1:3])
  mean.five <- sum(defects.five.month * westeros.production[1:2]) / sum(westeros.production[1:2])
  mean.six <- sum(defects.six.month * westeros.production[1:1]) / sum(westeros.production[1:1])
  westeros.data.id <- c(westeros.id[i], mean.one, mean.two, mean.three, mean.four, mean.five, mean.six)
  westerosDefectData <- rbind(westerosDefectData, westeros.data.id)
}

rownames(harpyDefectData) <- c()
rownames(westerosDefectData) <- c()
colnames(harpyDefectData) <- c("id", paste0("AverageDefectmonth", 1:6))
colnames(westerosDefectData) <- c("id", paste0("AverageDefectmonth", 1:6))

```

Äëÿ íà÷àëà ìû ïðî÷èòàåì èñõîäíûå äàííûå è ïðåîáðàçóåì ê óäîáíîìó äëÿ íàøåãî ïîäõîäà ôîðìàòó. Ïîñìîòðèì íà âûâîä.

```{r}
head(harpyDefectData)
head(westerosDefectData)
```


Íà âûõîäå ìû ïîëó÷èëè 2 äàòàôðåéìà, ñîäåðæàùèõ ñâîäíóþ èíôîðìàöèþ î äåôåêòàõ ïðîäóêöèè íà i-é ìåñÿö ïîñëå åå ðåàëèçàöèè êàæäûì èç 
êóçíåöîâ. Äëÿ äàëüíåéøåãî àíàëèçà ïðîâåäåì åùå íåñêîëüêî ìàíèïóëÿöèé ñ äàííûìè. 

```{r, include = FALSE}
resultWesteros <- c()
resultHarpy <- c()
for (i in 2:7) {
  subdata <- data.frame(
    value = westerosDefectData[, i],
    month = rep(i-1, length(westerosDefectData[, i]))
  )
  resultWesteros <- rbind(resultWesteros, subdata)
  
  subdata <- data.frame(
    value = harpyDefectData[, i],
    month = rep(i-1, length(harpyDefectData[, i]))
  )
  resultHarpy <- rbind(resultHarpy, subdata)
}


resultData <- rbind(resultHarpy, resultWesteros)
resultFrame <- cbind(resultData, c(rep('harpy', 300), rep('westeros', 300)))
colnames(resultFrame)[3] <- "company"

```

```{r}
head(resultFrame)
tail(resultFrame)
```

Ýòîò äàòàôðåéì ñîäåðæèò 3 ñòîëáöà: çíà÷åíèå äîëè äåôåêòà, ìåñÿö íà êîòîðûé ýòà äîëÿ äåôåêòà ðåàëèçîâàëàñü ïîñëå ïðîèçâîäñòâà ïðîäóêöèè è íàçâàíèå êîìïàíèè. Ïîñòðîèì 2 ãðàôèêà, êàæäûé èç êîòîðûõ ñîîòâåòñòâóåò êîìïàíèè, ò.å. îäèí ãðàôèê äëÿ Harpy, äðóãîé äëÿ
Westeros. Ãðàôèê áóäåò â âèäå boxplot.

```{r, echo=FALSE}
ggplot(resultFrame, aes(factor(month), value)) + geom_boxplot() + facet_grid(company ~ .)
```

Âåðõíèé ãðàôèê äëÿ êîìïàíèè Harpy, íèæíèé äëÿ Westeros. Íà îñíîâàíèè óâèäåííîãî ìîæíî ñäåëàòü âûâîäû. 
Æèðíàÿ ÷åðòà â boxplot ÿâëÿåòñÿ îòîáðàæåíèåì ñðåäíåãî çíà÷åíèÿ â êîíêðåòíûé ìåñÿö. Ìû âèäèì, ÷òî äëÿ Westeros ñðåäíåå çíà÷åíèå
óáûâàåò ëèíåéíî. ×òî êàñàåòñÿ âûñîòû ïðÿìîóãîëüíèêîâ (âûñîòà ñîîòâåòñòâóåò ïðîìåæóòêó ìåæäó íèæíèì è âåðõíèì êâàðòèëåì èëè äðóãèìè ñëîâàìè âûñîòà ñîîòâåòñòâóåò IQR, ò.í. èíòåðêâàíòèëüíîìó ðàçìàõó), òî îíà èçìåíÿåòñÿ òàêæå ëèíåéíî. Èç ýòîãî ñëåäóåò, ÷òî äîëÿ äåôåêòà ñ òî÷êè çðåíèÿ ñòàòèñòè÷åñêèõ ïîêàçàòåëåé ÿâëÿåòñÿ ëèíåéíî óáûâàþùåé ïî ñðåäíåìó è ñëàáî äèñïåðñèîííîé âåëè÷èíîé. Ýòîãî íåëüçÿ ñêàçàòü î äàííûõ ïî êîìïàíèè Harpy. Ìû âèäèì ðåçêèé ñêà÷îê ìåæäó 3-ì è 4-ì ìåñÿöåì, ÷òî óáèâàåò ëèíåéíîñòü õàðàêòåðèñòèê è ïîâûøàåò äèñïåðñèþ. Ýòîò ôàêò çíà÷èòåëüíî çàòðóäíèò ïðîãíîç, ÷òî ïðèâåäåò ê íåâûãîäíîñòè ñîòðóäíè÷åñòâà ñ ýòîé êîìïàíèåé. Èç âñåãî âûøåñêàçàííîãî ñëåäóåò, ÷òî ñ òî÷êè çðåíèÿ ñòàòèñòèêè íóæíî âûáðàòü êîìïàíèþ Westeros 
äëÿ ñîòðóäíè÷åñòâà.


