---
title: "Второе задание практикума"
author: "Работу выполнили: Григорьева Олеся, Константинова Мария, Козодой Антон"
output: html_notebook
---


###Описание задания

Необходимо провести разведывательный анализ данных с целью ответа на вопрос: "С каким из поставщиков стали следует заключить договор?" Радота ведется с  данными за прошедшие 7 месяцев из CSV-файла.


###Выполнение задания

Считываем CSV-файл и описываем необходимые нам для работы переменные. 
```{r}
matrix<-read.csv("production-data.csv",header=TRUE)
matrix
matrix$defects
matrix$unsullen.id    
matrix$production.date
matrix$report.date
matrix$produced
```

Считаем два вектора prod_sum_"co/inc" соответсвующие двум компаниям - harpy&co и Westeros incorporate соовественно.
Каждый вектор содержит 6 значений, которые вычисляются по принципу:
1 месяц : производство за 1 месяц минус сумаррный брак за 6 месяцев, и суммируется все по 50 кузнецам
2 месяц, соответственно, производство 2-ого минус суммарный брак, наблюдаемый за 5 месяцев и так далее.

Для компании harpy&co:
```{r}
prod_sum_co<-c(0,0,0,0,0,0)
def<-0
for (j in 1:50){
  for(i in 1:7){
    def = def + matrix$defects[(j-1)*27 + i]
  }  
  prod_sum_co[1] = prod_sum_co[1]+matrix$produced[(j-1)*27+1] - def
  def<-0
}

def<-0
for (j in 1:50){
  for(i in 1:6){
    def = def + matrix$defects[(j-1)*27 +i+7]
  }  
  prod_sum_co[2] = prod_sum_co[2]+matrix$produced[(j-1)*27+8] - def
  def<-0
}

def<-0
for (j in 1:50){
  for (i in 1:5){
    def=def+matrix$defects[(j-1)*27+i+13]
  }
  prod_sum_co[3] = prod_sum_co[3]+matrix$produced[(j-1)*27+14] - def
  def<-0
}  

def<-0
for (j in 1:50){
  for (i in 1:4){
    def=def+matrix$defects[(j-1)*27+i+18]
  }
  prod_sum_co[4] = prod_sum_co[4]+matrix$produced[(j-1)*27+19] - def
  def<-0
}  

def<-0
for (j in 1:50){
  for (i in 1:3){
    def=def+matrix$defects[(j-1)*27+i+22]
  }
  prod_sum_co[5] = prod_sum_co[5]+matrix$produced[(j-1)*27+23] - def
  def<-0
}  

def<-0
for (j in 1:50){
  for (i in 1:2){
    def=def+matrix$defects[(j-1)*27+i+25]
  }
  prod_sum_co[6] = prod_sum_co[6]+matrix$produced[(j-1)*27+26] - def
  def<-0
}  
prod_sum_co
```

Для комании  Westeros incorporate:
```{r}
prod_sum_inc<-c(0,0,0,0,0,0)
def<-0
for (j in 51:100){
  for(i in 1:7){
    def = def + matrix$defects[(j-1)*27 + i]
  }  
  prod_sum_inc[1] = prod_sum_inc[1]+matrix$produced[(j-1)*27+1] - def
  def<-0
}

def<-0
for (j in 51:100){
  for(i in 1:6){
    def = def + matrix$defects[(j-1)*27 +i+7]
  }  
  prod_sum_inc[2] = prod_sum_inc[2]+matrix$produced[(j-1)*27+8] - def
  def<-0
}

def<-0
for (j in 51:100){
  for (i in 1:5){
    def=def+matrix$defects[(j-1)*27+i+13]
  }
  prod_sum_inc[3] = prod_sum_inc[3]+matrix$produced[(j-1)*27+14] - def
  def<-0
}  

def<-0
for (j in 51:100){
  for (i in 1:4){
    def=def+matrix$defects[(j-1)*27+i+18]
  }
  prod_sum_inc[4] = prod_sum_inc[4]+matrix$produced[(j-1)*27+19] - def
  def<-0
}  

def<-0
for (j in 51:100){
  for (i in 1:3){
    def=def+matrix$defects[(j-1)*27+i+22]
  }
  prod_sum_inc[5] = prod_sum_inc[5]+matrix$produced[(j-1)*27+23] - def
  def<-0
}  

def<-0
for (j in 51:100){
  for (i in 1:2){
    def=def+matrix$defects[(j-1)*27+i+25]
  }
  prod_sum_inc[6] = prod_sum_inc[6]+matrix$produced[(j-1)*27+26] - def
  def<-0
}  
prod_sum_inc
```

Далее строим так называемый "ящики с усами" или диаграммы размахов для обеих компаний-производителей по таблице в которой первый столбец - это значения векторов, второй столбец соответсвующее название компании. 
Для этого используем функцию boxplot() и обозначаем диаграмму Harpy.co красным цветом, а Westeros.Inc - желтым.

```{r}
prod_sum<-c(prod_sum_co,prod_sum_inc)
company<-c("Harpy.co","Harpy.co","Harpy.co","Harpy.co","Harpy.co","Harpy.co","Westeros.Inc","Westeros.Inc","Westeros.Inc","Westeros.Inc","Westeros.Inc","Westeros.Inc")
table<-data.frame(Goods=prod_sum, Company=company)
boxplot(Goods~Company,data=table, col=c("red","yellow"))
```

Приступаем к прогнозированию. 
Найдем количество (относительно произведенных, в долях единицы) мечей из стали (1:2) компании,сломавшихся в (1:6) месяц, и попробуем определить,от чего оно зависит.

Оно может зависеть от: кузнеца, интенсивности боевых действий, качества стали и, возможно, еще каких-то внешних параметров.


```{r}
matrix<-read.csv("production-data.csv",header=TRUE)
produced <- c(matrix$produced[matrix$produced > 0])
produced
```

Методом пристального взгляда на таблицу мы устанавливаем, что кривые лучше искать отдельно для компаний.
relDefects - это точные значения кол-ва бракованных изделий из таблицы. Затем находим максимальное и минимальное отклонение.

```{r}
monthRelatedDefects<-rep(0,6);
monthRelatedDefectsMax<-rep(0,6);
monthRelatedDefectsMin<-rep(10,6);
for (i in 1:50) {
  monthDataIndex = 0;
  for (j in 1:6) {
    monthDataLength = (8-j);
    monthProduced = produced[(i-1)*6 + j];
    for (k in 2:monthDataLength) {
      relDefects = 
        matrix$defects[(i-1) * 27 + monthDataIndex + k] / monthProduced
      monthRelatedDefects[k-1] = monthRelatedDefects[k-1] + relDefects;
      if (relDefects > monthRelatedDefectsMax[k-1])
        monthRelatedDefectsMax[k-1] = relDefects;
      if (relDefects < monthRelatedDefectsMin[k-1])
        monthRelatedDefectsMin[k-1] = relDefects;
    }
    monthDataIndex = monthDataIndex + monthDataLength;
  }
}
```

Далее усредняем по кузецам и смотрим результат. 

```{r}
for (i in 1:6)
  monthRelatedDefects[i] = monthRelatedDefects[i]/(50*(7-i));
monthRelatedDefectsMin
monthRelatedDefectsMax
monthRelatedDefects
monthRelatedDefects.co<-monthRelatedDefects
```

Оказывается, что мечи из 1 стали начинают ломаться только на 4 месяц использования. Причем это не практически не зависит от кузнеца. Значения могут отличаться, но характер кривой для разных кузнецов сохраняется.

Проверим то же предположение для 2 стали:

```{r}
monthRelatedDefects<-rep(0,6);
monthRelatedDefectsMax<-rep(0,6);
monthRelatedDefectsMin<-rep(10,6);
for (i in 51:100) {
  monthDataIndex = 0;
  for (j in 1:6) {
    monthDataLength = (8-j);
    monthProduced = produced[(i-1)*6 + j];
    for (k in 2:monthDataLength) {
      relDefects = 
        matrix$defects[(i-1) * 27 + monthDataIndex + k] / monthProduced
      monthRelatedDefects[k-1] = monthRelatedDefects[k-1] + relDefects;
      if (relDefects > monthRelatedDefectsMax[k-1])
        monthRelatedDefectsMax[k-1] = relDefects;
      if (relDefects < monthRelatedDefectsMin[k-1])
        monthRelatedDefectsMin[k-1] = relDefects;
    }
    monthDataIndex = monthDataIndex + monthDataLength;
  }
}
for (i in 1:6)
  monthRelatedDefects[i] = monthRelatedDefects[i]/(50*(7-i));
monthRelatedDefectsMin
monthRelatedDefectsMax
monthRelatedDefects
monthRelatedDefects.inc<-monthRelatedDefects
```
Мечи из второй стали ломаются примерно в равных количествах по месяцам
Небольшое убывание кривой связано с тем, что общее количество целых мечей также убывает со временем

Визуализируем:
```{r}
month<-c(1,2,3,4,5,6)
plot(month,monthRelatedDefects.co,col="red",type="l",ylab="monthRelatedDefects")
lines(monthRelatedDefects.inc,col="yellow")

```

Так как кривые сильно отличаются по компаниям, можем предположить, что интенсивность боевых действий не оказывает большого влияния (т.е. она была примерно постоянна за время наблюдения), как и внешние факторы.

#Над заданием работали:
1) Григорьева Олеся - разработка подхода и написание кода. 
2) Константинова Мария - разработка подхода и написание отчет.
3) Козодой Антон - написание отчет и анализ резулитатов.