---
title: "Task 1"
author: "Gudkov-Shikov-Zhadanov"
date: "9 марта 2017 г"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

<!-- This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>. -->

<!-- When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this: -->



```{r, warning=FALSE}
library(zoo)
library(xts)
library(tseries)
library(TTR)
library(urca)
library(forecast)
library(MLmetrics)
fudata <- read.csv.zoo("training.csv", header = T, index.column = 1, FUN = as.Date, format = "%Y-%m-%d", sep = ',')
furesult <- read.zoo("testing.csv", header = T, index.column = 1, FUN = as.Date, format = "%Y-%m-%d", sep = ',')
fusred <- SMA(fudata, 10)
plot(fudata);
lines(fusred, col="brown")
adf.test(fudata, alternative = "stationary")
```

##Так как значение ДФ теста больше критических значений, ряд не является стационарным в широком смысле

```{r}
futs <- as.ts(zooreg(fudata, frequency = 12, start = 1959))
result <- as.ts(zooreg(furesult, frequency = 12, start = 1989))
adit <- decompose(futs)
plot(adit)
adf.test(na.remove(adit$trend), alternative = "stationary")
adf.test(na.remove(adit$random), alternative = "stationary")
adf.test(na.remove(adit$seasonal), alternative = "stationary")
multi <-decompose(futs, type = c("multi"))
plot(multi)
adf.test(na.remove(multi$trend), alternative = "stationary")
adf.test(na.remove(multi$random), alternative = "stationary")
adf.test(na.remove(multi$seasonal), alternative = "stationary")

```  

##Как видно из тестов ДФ ряды сезональности и остатка являются стационарными, ряды тренда не являются стационарными

```{r}
fudiff <- diff(futs, differences=1)
adf.test(fudiff, alternative = "stationary")
```

##Из теста ДФ видно, что разность первого порядка является стационарным рядом, а значит ряд является интегрированным порядка 1.

```{r}
acf(fudiff, plot = TRUE)
pacf(fudiff, plot = TRUE)
```

##Из функции автокорреляции и функции частичной автокорреляции видно, что параметр p = 2 или 3, а параметр q = 4 или 5.

```{r}
furima24 <- arima(futs, order = c(2,1,4))
AIC(furima24)
prognoz24 <-forecast(furima24, h=60)
r224 <- R2_Score(prognoz24$mean,result)
r224*r224
furima25 <- arima(futs, order = c(2,1,5))
AIC(furima25)
prognoz25 <-forecast(furima25, h=60)
r225 <- R2_Score(prognoz25$mean,result)
r225*r225
furima34 <- arima(futs, order = c(3,1,4))
AIC(furima34)
prognoz34 <-forecast(furima34, h=60)
r234 <- R2_Score(prognoz34$mean,result)
r234*r234
furima35 <- arima(futs, order = c(3,1,5))
AIC(furima35)
prognoz35 <-forecast(furima35, h=60)
r235 <- R2_Score(prognoz35$mean,result)
r235*r235
plot(result);
plot(prognoz24)
plot(prognoz25)
plot(prognoz34)
plot(prognoz35)

```

##Судя по величине R^2 наиболее точный прогноз дает модель с коэф (3,1,4), по информационному критерию Акаике она незначительно уступает остальным, по критерию Акаике оптимальной является модель с коэф(2,1,5), но она сильно хуже модели (3,1,4) по величине R^2, а значит модель ARIMA(3,1,4) является оптимальной.
