---
title: "R Notebook"
output: html_notebook
---


```{r}
#Считать данные и создать из входных данных временной ряд:
training <- read.csv("training.csv", header = TRUE, sep = ",")
TStraining <- ts(data = training$Value,frequency = 12,start = c(1959,01,01))
```


Провести визуальную оценку, отрисовав ряд и скользящую статистику
```{r}

library(TTR)
SMAtraining <- SMA(TStraining, n = 20)
SMAtraining <- ts(data = SMAtraining, frequency = 12, start = c(1959,01,01))
plot(SMAtraining, type="l", col=2)
lines(TStraining, type="l")

```


Вывод: Так как у графика наблюдается явный тренд, и скользящая средняя не константна на различных моментах времени (явное возрастание), то ряд не является стационарным в широком смысле.



#Разложить временной ряд на тренд, сезональность, остаток в соответствии с аддитивной, мультипликативной моделями(выполнила Московченко).

Разложим временной ряд на тренд, cезональность и остаток в соответствии с аддитивной моделью.
```{r}
decompose = decompose(TStraining)
plot(decompose)
```
Результат в файле: Rplot.png



Разложим временной ряд на тренд, cезональность и остаток в соответствии с мультипликативной моделью.
```{r}
decompose_multi = decompose(TStraining, type = c("multi"))
```



Оценим стационарность получившихся рядов.
Как можно заметить, графики тренда для аддитивной и мультипликативной моделей не имеет ярких выбросов и имеет ярко выраженный тренд. Из это можно сделать вывод о том, что ряд не является стационарным.

Для определения стационарности рядов сезональности и остатка используем тест Дики-Фуллера.
Стационарность остатка для аддитивной и мультипликативной модели:
```{r}
library(urca)
test_season_add = ur.df(decompose$seasonal)
summary(test_season_add)
test_random_add = ur.df(decompose$random[20:340])
summary(test_random_add)

test_season_multi = ur.df(decompose_multi$seasonal)
summary(test_season_multi)
test_random_multi = ur.df(decompose_multi$random[20:340])
summary(test_random_multi)


```


##Проверить является ли временной ряд интегрированным порядка k. Если является, применить к нему модель ARIMA:

Вычислить первые разности ряда и проверить ряд на стационарность с помощью теста Дики-Фуллера
```{r}
diff <- diff(TStraining, differences = 1)
plot(diff)
dftest = ur.df(diff)
summary(dftest)
```





Найти параметры p и q для модели ARIMA, для этого построить ACF И PACF
```{r}
acf <- acf(x = diff,plot = TRUE)
pacf <- pacf(x = diff, plot = TRUE)
```
Вывод: по коррелограмме ACF acf.png можно определить количество автокорреляционных коэффициентов сильно отличных от 0 => q=4. по коррелограмме PACF pacf.png можно определить количество автокорреляционных коэффициентов сильно отличных от 0 => p=1. Можем построить модель ARIMA c параметрами (1,1,4)




Cтроим модели ARIMA(1,1,4), ARIMA(0,1,4), ARIMA(1,1,0), ARIMA(1,1,1)
```{r}
modelARIMA1 <- arima(TStraining, order=c(1,1,4))
modelARIMA1
modelARIMA2 <- arima(TStraining, order=c(0,1,4))
modelARIMA2
modelARIMA3 <- arima(TStraining, order=c(1,1,0))
modelARIMA3
modelARIMA4 <- arima(TStraining, order=c(1,1,1))
modelARIMA4
```
По критерию Акаике лучшая модель с параметрами (0,1,4)



##Отобрать несколько моделей. Предсказать значения для тестовой выборки. Визуализировать их, посчитать r2 score для каждой из моделей. (Выполнил Абрамов)

Рассмотрим уже полученную модель ARIMA(0,1,4)
Загрузим тестовые данные и посторим графики
```{r}
library("forecast")
arimaForecast <- forecast.Arima(modelARIMA2, h=60)
plot(arimaForecast)
testing <- read.csv("testing.csv", header = TRUE, sep = ",")
TStesting <- ts(data=testing$Value, frequency = 12 , start = c(1989,01,01))
lines(TStesting, type="l", col=2)
```





Посчитаем R^2
```{r}
r2_score <- lm(arimaForecast$mean~TStesting)
summary(r2_score)
```


Cтроим модель ES (Exponential Smoothing)

Загрузим тестовые данные и посторим графики
```{r}
fc.etc=forecast(TStraining,h=60)
plot(fc.etc)
testing <- read.csv("testing.csv", header = TRUE, sep = ",")
TStesting <- ts(data = testing$Value,frequency = 12,start = c(1989,01,01))
lines(TStesting,type="l",col=2)
```




Посчитаем R^2
```{r}
r2_score <- lm(fc.etc$mean~TStesting)
summary(r2_score)

```

Вывод: ARIMA: aic = 253.34 R-squared = 0.008505; ETS: aic = 1359.671 R-squared = 0.06312. По параметру R-squared модель ETS незначительно, но лучше модели ARIMA, с другой стороны по информационному критерию Акаике модель ARIMA значительно лучше модели ETS. => Модель ARIMA лучше.




