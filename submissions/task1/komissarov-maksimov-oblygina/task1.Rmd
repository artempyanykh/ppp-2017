---
title: "Task 1"
author: "Komissarov, Maksimov, Oblygina"
date: "12 March 2017"
output:
  html_document: default
---

```{r setup, include = FALSE}
library(xts)
library(zoo)
library(tseries)
library(forecast)
library(MLmetrics)
```

1 этап.
## Reading of data


```{r read}
ts <- read.csv.zoo("training.csv",
                   index.column = 1,
                   FUN = as.Date, format = "%Y-%m-%d")

ts.monthly <- zooreg(ts, frequency = 12, start = c(1959, 1))

test <- zooreg(read.csv.zoo("testing.csv",
                     index.column = 1,
                     FUN = as.Date, format = "%Y-%m-%d"),
                     frequency = 12, start = c(1989, 1))
```

```{r, echo=FALSE}
plot(ts)
lines(rollmean(ts, 20), col = 2)
lines(rollmean(ts, 100), col = 3)
```
Как можно заметить, график не имеет ярких выбросов и имеет ярко выраженный тренд. Скользящая средняя явно возрастает. Из это можно сделать вывод о том, что ряд не является стационарным в широком смысле. Убедимся в этом, проведя тест Дики - Фуллера:

## Dickey-Fuller


```{r adf}
adf.test(ts, k = 0)
```

Есть единичные корни, ряд не стационарен.
Высокое p-value дает нам возможность утверждать, что ряд не стационарен.

2 этап.

## Decomposition

ddldldl

```{r decompose}
ts.add <- decompose(as.ts(ts.monthly), type = "additive")
ts.mul <- decompose(as.ts(ts.monthly), type = "multiplicative")
plot(ts.add)
plot(ts.mul)
```

Вывод по графикам

```{r adf on decomposition, message=FALSE}
adf.test(na.remove(ts.mul$trend), k = 0)
adf.test(na.remove(ts.mul$seasonal), k = 0)
```

Вывод по ДФ

## Order of integration

```{r integr, warning=FALSE}
ts.diff <- diff(ts, differences = 1)
plot(ts.diff)
adf.test(ts.diff, k = 0)
```

Вывод о порядке интегрированности

## Correlation coefficients

```{r acfpacf, warning=FALSE}
acf(coredata(ts.diff))
pacf(coredata(ts.diff))
```

Предположения о (p, d, q)

## ARIMA 1

```{r arima_1, warning=FALSE}
ts.arima_1 = Arima(ts.monthly, order = c(4, 1, 6))
for.arima_1 = forecast(ts.arima_1, h = 60)
plot(as.ts(test)); lines(for.arima_1$mean, col = 2)
R2_Score(for.arima_1$mean, test)
```

## ARIMA 2

```{r arima_2, warning=FALSE}
ts.arima_2 = Arima(ts.monthly, order = c(3, 1, 5))
for.arima_2 = forecast(ts.arima_2, h = 60)
plot(as.ts(test)); lines(for.arima_2$mean, col = 2)
R2_Score(for.arima_2$mean, test)
```

## Neural Network

```{r nn, warning=FALSE}
ts.nn <- nnetar(as.ts(ts.monthly), p = 5)
for.nn = forecast(ts.nn, h = 60)
plot(as.ts(test)); lines(for.nn$mean, col = 2)
R2_Score(for.nn$mean, test)
```

## Linear Model

```{r lm, warning=FALSE}
ts.lm <- tslm(as.ts(ts.monthly) ~ trend + season)
for.lm = forecast(ts.lm, h = 60)
plot(as.ts(test)); lines(for.lm$mean, col = 2)
R2_Score(for.lm$mean, test)
```
